<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Overview · NMRHamiltonian.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>NMRHamiltonian.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Overview</a><ul class="internal"><li><a class="tocitem" href="#Table-of-contents"><span>Table of contents</span></a></li><li><a class="tocitem" href="#Install"><span>Install</span></a></li><li class="toplevel"><a class="tocitem" href="#Important-exported-functions"><span>Important exported functions</span></a></li><li><a class="tocitem" href="#Julia-Basics"><span>Julia Basics</span></a></li><li class="toplevel"><a class="tocitem" href="#A-compiled-list-of-physical-chemistry-parameters"><span>A compiled list of physical chemistry parameters</span></a></li><li><a class="tocitem" href="#Citation"><span>Citation</span></a></li><li><a class="tocitem" href="#Download-a-NMR-parameters-dataset-via-DataDeps.jl"><span>Download a NMR parameters dataset via DataDeps.jl</span></a></li><li class="toplevel"><a class="tocitem" href="#Terminology"><span>Terminology</span></a></li><li class="toplevel"><a class="tocitem" href="#License"><span>License</span></a></li><li class="toplevel"><a class="tocitem" href="#Authors"><span>Authors</span></a></li><li class="toplevel"><a class="tocitem" href="#Funding"><span>Funding</span></a></li></ul></li><li><a class="tocitem" href="api/">Public API</a></li><li><a class="tocitem" href="demo_code/">Demo: code walk-through</a></li><li><a class="tocitem" href="return_vars/">Demo: return variables</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Overview</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Overview</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/main/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="NMRHamiltonian.jl"><a class="docs-heading-anchor" href="#NMRHamiltonian.jl">NMRHamiltonian.jl</a><a id="NMRHamiltonian.jl-1"></a><a class="docs-heading-anchor-permalink" href="#NMRHamiltonian.jl" title="Permalink"></a></h1><p>NMRHamiltonian is a library for simulating the resonance frequencies and relative intensities of compounds in isotropic liquid. It is intended for 1D 1H NMR, which is a spin-1/2 NMR. </p><h2 id="Table-of-contents"><a class="docs-heading-anchor" href="#Table-of-contents">Table of contents</a><a id="Table-of-contents-1"></a><a class="docs-heading-anchor-permalink" href="#Table-of-contents" title="Permalink"></a></h2><ul><li><a href="#NMRHamiltonian.jl">NMRHamiltonian.jl</a></li><li class="no-marker"><ul><li><a href="#Table-of-contents">Table of contents</a></li><li><a href="#Install">Install</a></li></ul></li><li><a href="#Important-exported-functions">Important exported functions</a></li><li class="no-marker"><ul><li><a href="#Julia-Basics">Julia Basics</a></li></ul></li><li><a href="#A-compiled-list-of-physical-chemistry-parameters">A compiled list of physical chemistry parameters</a></li><li class="no-marker"><ul><li><a href="#Citation">Citation</a></li><li><a href="#Download-a-NMR-parameters-dataset-via-DataDeps.jl">Download a NMR parameters dataset via DataDeps.jl</a></li></ul></li><li><a href="#Terminology">Terminology</a></li><li><a href="#License">License</a></li><li><a href="#Authors">Authors</a></li><li><a href="#Funding">Funding</a></li></ul><h2 id="Install"><a class="docs-heading-anchor" href="#Install">Install</a><a id="Install-1"></a><a class="docs-heading-anchor-permalink" href="#Install" title="Permalink"></a></h2><p>NMRHamiltonian is hosted on a custom Julia registry. We need to add that before installing NMRHamiltonian: </p><pre><code class="language-julia hljs">using Pkg
Pkg.Registry.add(RegistrySpec(url = &quot;https://github.com/AI4DBiological-Systems/PublicJuliaRegistry&quot;))
Pkg.add(&quot;NMRHamiltonian&quot;)</code></pre><p>To update this package once it is installed, do</p><pre><code class="language-julia hljs">using Pkg
Pkg.update(&quot;NMRHamiltonian&quot;)</code></pre><h1 id="Important-exported-functions"><a class="docs-heading-anchor" href="#Important-exported-functions">Important exported functions</a><a id="Important-exported-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Important-exported-functions" title="Permalink"></a></h1><p>The following functions are the focus of NMRHamiltonian:</p><ul><li><p><code>getphysicalparameters()</code> given a list of compound aliases, parse the physical chemistry parameters from file to data structure.</p></li><li><p><code>SHConfig()</code> assembles the simulation configuration container variable. This is a constructor to a composite data type (i.e., this data type is like the C programming language&#39;s <code>struct</code>).</p></li><li><p><code>simulate()</code> the outputs of <code>getphysicalparameters()</code> and <code>SHConfig()</code>, and returns a data structure that contain the simulated frequencies and relative intensities for each resonance comonents, and their resonance groups.</p></li></ul><p>This is not a full quantum simulation of the NMR spectrum; only the frequencies, intensities, and this partition of the resonance components called a set of <em>resonance groups</em> is returned.</p><p>See the demo pages for an example walk-through of how to use this library.</p><h2 id="Julia-Basics"><a class="docs-heading-anchor" href="#Julia-Basics">Julia Basics</a><a id="Julia-Basics-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-Basics" title="Permalink"></a></h2><ul><li><p>Read the <a href="https://docs.julialang.org/en/v1/stdlib/Pkg/">Julia documentation</a> for installing Julia packages.</p></li><li><p>We use 1-indexing for addressing arrays here, but you can use <code>[begin + n]</code> instead of <code>[n]</code> if you wish to use a 0-indexing index <code>n</code>. </p></li></ul><h1 id="A-compiled-list-of-physical-chemistry-parameters"><a class="docs-heading-anchor" href="#A-compiled-list-of-physical-chemistry-parameters">A compiled list of physical chemistry parameters</a><a id="A-compiled-list-of-physical-chemistry-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#A-compiled-list-of-physical-chemistry-parameters" title="Permalink"></a></h1><p>The <code>getphysicalparameters()</code> function in NMRHamiltonian requires the user to supply it with a list of compound aliases, each of which is a string called an <code>entry</code>, as well as the corresponding file path of each entry to a JSON file that stores its physical chemistry parameters. These parameters are the chemical shift and J-coupling values of an compound, as we are only concerned with spin-1/2 NMR in isotropic liquid in NMRHamiltonian. As some of these values change as a function of ambient temperature, pH, spectrometer frequency, one can have multiple entries that describe the same compound for different experimental or spectrometer configurations.</p><p>The demo and test scripts for NMRHamiltonian.jl requires the compiled list of parameters at <a href="https://zenodo.org/record/8174261">10.5281/zenodo.8174261</a>, but you are encouraged to devise your own that follows its JSON format. You&#39;ll need a alias-to-file-path mapping file, which is the <code>molecule_name_mapping/selected_molecules.json</code> file from this dataset. You&#39;ll also need the individual parameter files for each compound at a certain experimental or spectrometer configurations, which are the files in the <code>coupling_info</code> folder from this dataset. See these files to get a sense of how the format is like.</p><p>For the parameter files, the JSON file structure goes like this:</p><pre><code class="language-json hljs">{
       &quot;J-coupling&quot;: [
                       {
                            &quot;ID2&quot;: 9,
                            &quot;ID1&quot;: 8,
                          &quot;value&quot;: -12.531894
                       },
                       {
                            &quot;ID2&quot;: 10,
                            &quot;ID1&quot;: 8,
                          &quot;value&quot;: 3.511369
                       },
                       {
                            &quot;ID2&quot;: 10,
                            &quot;ID1&quot;: 9,
                          &quot;value&quot;: 5.979
                       }
                     ],
   &quot;chemical shift&quot;: [
                       {
                          &quot;value&quot;: 3.9744,
                             &quot;ID&quot;: 8
                       },
                       {
                          &quot;value&quot;: 3.9352,
                             &quot;ID&quot;: 9
                       },
                       {
                          &quot;value&quot;: 3.83016,
                             &quot;ID&quot;: 10
                       }
                     ]
}</code></pre><p>This is the <code>L-Serine_mod.json</code> file in <code>coupling_info</code> from the dataset. This indicates that there are J-couplings (nucleus 1 ID, nucleus 2 ID, J-coupling value in Hz) = (8, 9, -12.531894), (8, 10, 3.511369), (9, 10, 5.979). There are chemical shifts for each nuclei: (8, 3.9744 ppm), (9, 3.9352 ppm), (10, 3.83016 ppm).</p><p>You can construct ficticious compound entries and simulate it, just to see what the resonance frequencies and intensities might look like.</p><p>For the mapping file, it follows the format:</p><pre><code class="language-json hljs">{
    &quot;Dopamine - 500 MHz&quot;: {
        &quot;notes&quot;: &quot;http://gissmo.bmrb.io/entry/bmse000909/simulation_1&quot;,
        &quot;file name&quot;: &quot;bmse000909_simulation_1.json&quot;
    },
    &quot;L-Cystine&quot;: {
        &quot;notes&quot;: &quot;http://gissmo.bmrb.io/entry/bmse000035/simulation_1&quot;,
        &quot;file name&quot;: &quot;bmse000035_simulation_1.json&quot;
    },
}</code></pre><p>It means that the parameter file for compound alias &quot;Dopamine - 500 MHz&quot; is <code>bmse000909_simulation_1.json</code> in the <em>nuclei parameter file path folder</em>, which together with the file path for the mapping file, are inputs to the <code>getphysicalparameters()</code> function in this library. We will go over this function in the demo.</p><h2 id="Citation"><a class="docs-heading-anchor" href="#Citation">Citation</a><a id="Citation-1"></a><a class="docs-heading-anchor-permalink" href="#Citation" title="Permalink"></a></h2><p>Please cite <a href="https://zenodo.org/record/8174261">10.5281/zenodo.8174261</a> and the appropriate references within if you use any physical chemistry values from it. The references to the original data sources from which these values were curated from are also in the instructions.</p><h2 id="Download-a-NMR-parameters-dataset-via-DataDeps.jl"><a class="docs-heading-anchor" href="#Download-a-NMR-parameters-dataset-via-DataDeps.jl">Download a NMR parameters dataset via DataDeps.jl</a><a id="Download-a-NMR-parameters-dataset-via-DataDeps.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Download-a-NMR-parameters-dataset-via-DataDeps.jl" title="Permalink"></a></h2><p>Run the following commands to load the <code>getdatapath()</code> function into Julia REPL, which calls <a href="https://github.com/oxinabox/DataDeps.jl">DataDeps.jl</a> to download and uses <a href="https://github.com/JuliaIO/Tar.jl">Tar.jl</a> and <a href="https://github.com/JuliaIO/CodecZlib.jl">CodecZlib</a> to extract the files on your local machine. If you usually use a source file workflow, these commands are stored in <code>examples/helpers/data.jl</code> in the NMRHamiltonian repository.</p><pre><code class="language-julia hljs">using DataDeps, Tar, CodecZlib


function getdatapath()::String

    dataset_alias = &quot;AI4DBiological-Systems_NMR_data&quot; # don&#39;t use spaces or &#39;strange&#39; symbols like commas, colons, etc.
    archive_file_name = &quot;nmr_physical_parameters_dataset.tar.gz&quot; # the filename on the data repository that we download.
    url = &quot;https://zenodo.org/record/8174261/files/nmr_physical_parameters_dataset.tar.gz?download=1&quot;

    register(DataDep(&quot;$dataset_alias&quot;,
        &quot;&quot;&quot;
        Dataset: Selected BMRB 1D 1H NMR data and physical chemistry values compiled from literature
        Author: Roy Chih Chung Wang
        License: [Creative Commons Attribution Non Commercial Share Alike 4.0 International](https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode)
        DOI: 10.5281/zenodo.8174261

        Description:
        The experiments were downloaded from BMRB,
        The physical chemistry parameters data and sample configuration-related files were collected, organized, converted or manually entered in as JSON files by Roy.
        The physical chemistry parameters, i.e., chemical shift and J-coupling values, are from two sources:
        - GISSMO: (https://gissmo.bmrb.io/ acccessed Mar. 2023). See Dashti, et. al. DOI: 10.1021/acs.analchem.8b02660 and DOI: 10.1021/acs.analchem.7b02884 for more details.
        - From Govindaraju, et. al.&#39;s work: DOI: 10.1002/1099-1492(200005)13:3&lt;129::AID-NBM619&gt;3.0.CO;2-V

        Please cite the data sources and this data repository if you find the contents helpful for your work. See the Zenodo DOI entry for more description.
        &quot;&quot;&quot;,
        url
    ));

    #readdir(datadep&quot;AI4DBiological-Systems NMR data&quot;) # have to manually type out the alias. Does not allow string variable substitution.
    local_dataset_archive_path = @datadep_str(&quot;$dataset_alias&quot;) # call the actual macro to allow string variable substitution.

    # extract archive, then delete. Do this only if archive file still exists.

    root_data_path = joinpath(local_dataset_archive_path, &quot;contents&quot;)
    
    if isfile(joinpath(local_dataset_archive_path, archive_file_name))
        t = @task begin; ispath(root_data_path) || mkpath(root_data_path); end
        schedule(t); wait(t)
    
        #t = @task begin; Tar.extract(joinpath(local_dataset_archive_path, archive_file_name), root_data_path); end
        t = @task begin; extractuncompress(joinpath(local_dataset_archive_path, archive_file_name), root_data_path); end
        schedule(t); wait(t)
        rm(joinpath(local_dataset_archive_path, archive_file_name)) # delete the archive file.
    end

    return root_data_path

    # # return root_data_path. however, this unpacks in the current working directory!
    # archive_file_path = joinpath(local_dataset_archive_path, archive_file_name)
    # if isfile(archive_file_path)
    #     DataDeps.unpack(archive_file_path)
    # end
    #return local_dataset_archive_path
end

function extractuncompress(src_path, dest_path)
    tar_gz = open(src_path)
    tar = GzipDecompressorStream(tar_gz)
    dir = Tar.extract(tar, dest_path)
    close(tar)
    
    return dir
end</code></pre><p>Now, run this function to download and extract the data.</p><pre><code class="language-julia hljs">getdatapath()</code></pre><h1 id="Terminology"><a class="docs-heading-anchor" href="#Terminology">Terminology</a><a id="Terminology-1"></a><a class="docs-heading-anchor-permalink" href="#Terminology" title="Permalink"></a></h1><ul><li><p>A <em>ME-modulo nuclei index</em> corresponds to a maximal set of nuclei where each nucleus is magnetically equivalent (ME) with all other nucleus in that maximal set. For example: if compound X has 10 nuclei contributing to its 1D 1H NMR spectrum, but nucleus #2 and #5 are ME, the other nucleus do not form ME with each other, then we can re-label the nuclei indices <code>i = 1, 2, ..., 10</code> to the ME-modulo nuclei index <code>j = 1, 2, ..., 9</code>, with <code>j = 2</code> denoting the set of nuclei <code>{i == 2, i == 5}</code>. The order of coherences-related quantities in NMRHamiltonian use ME-modulo nuclei indices as oppose to the nuclei indices.</p></li><li><p>A <em>radial</em> frequency in units of radians is a frequency in Hz multiplied by 2π.</p></li><li><p>A <em>resonance group</em> is a set of resonance components that have similar degrees-of-freedom. The set of resonance groups of a spin system is a partition of the resonance components for that spin system.</p></li><li><p>A <em>part</em> is an element of a partition of a set <code>X</code>. This means a part is a subset of <code>X</code>.</p></li><li><p>Throughout this documentation, we use <code>x == y</code> to mean the value in variable <code>x</code> equals to the value in variable <code>y</code>. We use <code>x = y</code> to mean we assign the variable <code>x</code> the value  <code>y</code>.</p></li></ul><h1 id="License"><a class="docs-heading-anchor" href="#License">License</a><a id="License-1"></a><a class="docs-heading-anchor-permalink" href="#License" title="Permalink"></a></h1><p>NMRHamiltonian has the Mozilla Public License Version 2.0.</p><h1 id="Authors"><a class="docs-heading-anchor" href="#Authors">Authors</a><a id="Authors-1"></a><a class="docs-heading-anchor-permalink" href="#Authors" title="Permalink"></a></h1><p>Code author: Roy Chih Chung Wang devised and implemented this library.</p><p>Supervisors: Dave Campbell (Carleton University, Bank of Canada) and Miroslava Čuperlović-Culf (National Research Council of Canada).</p><h1 id="Funding"><a class="docs-heading-anchor" href="#Funding">Funding</a><a id="Funding-1"></a><a class="docs-heading-anchor-permalink" href="#Funding" title="Permalink"></a></h1><p>This projected was funded by the AI-for-Design Challenge Program from the National Research Council of Canada.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="api/">Public API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Saturday 22 July 2023 14:35">Saturday 22 July 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
