<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Public API · NMRHamiltonian.jl</title><meta name="title" content="Public API · NMRHamiltonian.jl"/><meta property="og:title" content="Public API · NMRHamiltonian.jl"/><meta property="twitter:title" content="Public API · NMRHamiltonian.jl"/><meta name="description" content="Documentation for NMRHamiltonian.jl."/><meta property="og:description" content="Documentation for NMRHamiltonian.jl."/><meta property="twitter:description" content="Documentation for NMRHamiltonian.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">NMRHamiltonian.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li class="is-active"><a class="tocitem" href>Public API</a><ul class="internal"><li><a class="tocitem" href="#Physical-chemistry-parameters-of-compounds"><span>Physical chemistry parameters of compounds</span></a></li><li><a class="tocitem" href="#Simulation"><span>Simulation</span></a></li><li><a class="tocitem" href="#Serialization,-input/output"><span>Serialization, input/output</span></a></li></ul></li><li><a class="tocitem" href="../demo_code/">Demo: code walk-through</a></li><li><a class="tocitem" href="../return_vars/">Demo: return variables</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Public API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Public API</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/main/docs/src/api.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Function-References"><a class="docs-heading-anchor" href="#Function-References">Function References</a><a id="Function-References-1"></a><a class="docs-heading-anchor-permalink" href="#Function-References" title="Permalink"></a></h1><h2 id="Physical-chemistry-parameters-of-compounds"><a class="docs-heading-anchor" href="#Physical-chemistry-parameters-of-compounds">Physical chemistry parameters of compounds</a><a id="Physical-chemistry-parameters-of-compounds-1"></a><a class="docs-heading-anchor-permalink" href="#Physical-chemistry-parameters-of-compounds" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.PhysicalParamsType" href="#NMRHamiltonian.PhysicalParamsType"><code>NMRHamiltonian.PhysicalParamsType</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">struct PhysicalParamsType{T}
- H_IDs::Vector{Int}
- H_inds_sys::Vector{Vector{Int}}
- cs_sys::Vector{Vector{T}}
- H_inds_singlets::Vector{Vector{Int}}
- cs_singlets::Vector{T}
- J_inds_sys::Vector{Vector{Tuple{Int,Int}}}
- J_inds_sys_local::Vector{Vector{Tuple{Int,Int}}}
- J_vals_sys::Vector{Vector{T}}
- ME::Vector{Vector{Vector{Int}}}</code></pre><p>The chemical shift and J-coupling values with respect to nuclei labels for a molecule. Based on this information, an algorithm is used to create magnetic equivalence information in <code>ME</code>.</p><p>Details ≡≡≡≡≡≡≡≡</p><ul><li><code>H_IDs</code><code>::Vector{Int}</code></li></ul><p>Numerical (positive integer) numbering of nuclei for a molecule entry. This numbering is taken from a file, so it is not guaranteed to be consecutive nor start at 1.</p><ul><li><code>H_inds_sys</code><code>::Vector{Vector{Int}}</code></li></ul><p>Nested list of nuclei labels in consecutive positive integers, which <code>NMRHamiltonian</code> refers to as nuclei indices. The element at <code>[i]</code> is a list of nuclei indices for the i-th non-singlet spin system.</p><ul><li><code>cs_sys</code><code>::Vector{Vector{T}}</code></li></ul><p>Nested list of non-singlet chemical shifts. The element at <code>[i]</code> is a list of chemical shift values for the i-th non-singlet spin system.</p><ul><li><code>H_inds_singlets</code><code>::Vector{Vector{Int}}</code></li></ul><p>Nested list of nuclei labels in consecutive positive integers, which <code>NMRHamiltonian</code> refers to as nuclei indices. The element at <code>[i]</code> is a list of nuclei indices that contribute to the same i-th singlet.</p><ul><li><code>cs_singlets</code><code>::Vector{T}</code></li></ul><p>List of chemical shift values for singlets.</p><ul><li><code>J_inds_sys</code><code>::Vector{Vector{Tuple{Int,Int}}}</code></li></ul><p>Nested list of pairs of nuclei indices. The element at <code>[i]</code> is a list of J-coupling indices for the i-th non-singlet spin system. J-coupling index is a pair of nuclei indices.</p><ul><li><code>J_inds_sys_local</code><code>::Vector{Vector{Tuple{Int,Int}}}</code></li></ul><p>Nested list of pairs of nuclei indices. The element at <code>[i]</code> is a list of J-coupling indices for the i-th non-singlet spin system. J-coupling index is a pair of nuclei indices. The nuclei indices are re-numbered to start from 1 for each spin system, which <code>NMRHamiltonian</code> refers to as local nuclei indices.</p><p>Internally, spin Hamiltonian matrices for each spin system use this particular indexing scheme in their construction.</p><ul><li><code>J_vals_sys</code><code>::Vector{Vector{T}}</code></li></ul><p>Nested list of J-coupling values. The element at <code>[i]</code> is a list J-coupling values for the i-th non-singlet spin system.</p><ul><li><code>ME</code><code>::Vector{Vector{Vector{Int}}}</code></li></ul><p>The element at <code>[i][k]</code> is a list of nuclei indices that are magnetically equivalent. The indices in this list collectively make up the k-th magnetically equivalent group in the i-th spin system. The nuclei indices are re-numbered to start from 1 for each spin system, which <code>NMRHamiltonian</code> refers to as local nuclei indices.</p><p>Note that <code>NMRHamiltonian</code> defines magnetically equivalent groups must have two or more nuclei, and these equivalence are determined only based on the J-coupling and chemical shift values provided in the corresponding file for the molecule entry at hand.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/types.jl#L127-L155">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.getphysicalparameters" href="#NMRHamiltonian.getphysicalparameters"><code>NMRHamiltonian.getphysicalparameters</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">getphysicalparameters(
    ::Type{T},
    target_entries::Vector{String},
    H_params_path::String,
    molecule_mapping_file_path;
    unique_cs_digits::Int = 6,
) where T &lt;: AbstractFloat</code></pre><p>Assemble the J-coupling and chemical shift values from JSON files for the specified molecules.</p><p><strong>Nomenclature</strong></p><p>One set of J-coupling and one set of chemical shift values for a molecule is what NMRHamiltonian.jl calls a molecule entry.</p><p>It is common to see different J-coupling values of the same molecule reported in literature for similar experimental conditions.  NMRHamiltonian.jl requires one to record each instance as separate molecule entry.</p><p>Every molecule entry is recorded as a separate JSON file with some arbitrary file name the data collector wants to use. An additional name-mapping JSON file is needed to translate what the NMRHamiltonian.jl user wants to label the entries to what is the data collector chose to name the JSON files. The name-mapping JSON file is likely to require manual set up.</p><p><strong>Inputs</strong></p><ul><li><code>::Type{T}</code>       – The <code>AbstractFloat</code> datatype to use for storing floating-point data. A viable input here is <code>Float64</code>, which specifies double precision floating-point numbers are to be used.</li><li><code>target_entries</code>  – list of molecule entry names.</li><li><code>H_params_path</code>   – path to the directory that contain the J-coupling and chemical shift JSON files. Each file corresponds to one entry of a molecule, and has a set of chemical shifts and J-coupling information in the JSON dictionary format.   <code>ID1</code> and <code>ID2</code> are JSON dictionary keys that specify the spin nucleus label for J-coupling values, and <code>ID</code> is the nucleus label for chemical shift values. The following is an example of the JSON format for a L-Histidine entry:</li></ul><pre><code class="nohighlight hljs">{
       &quot;J-coupling&quot;: [
                       {
                            &quot;ID2&quot;: 13,
                            &quot;ID1&quot;: 12,
                          &quot;value&quot;: -15.350518
                       },
                       {
                            &quot;ID2&quot;: 16,
                            &quot;ID1&quot;: 12,
                          &quot;value&quot;: 7.63377
                       },
                       {
                            &quot;ID2&quot;: 16,
                            &quot;ID1&quot;: 13,
                          &quot;value&quot;: 5.029267
                       }
                     ],
   &quot;chemical shift&quot;: [
                       {
                          &quot;value&quot;: 3.18747,
                             &quot;ID&quot;: 12
                       },
                       {
                          &quot;value&quot;: 3.26837,
                             &quot;ID&quot;: 13
                       },
                       {
                          &quot;value&quot;: 7.14078,
                             &quot;ID&quot;: 14
                       },
                       {
                          &quot;value&quot;: 8.02487,
                             &quot;ID&quot;: 15
                       },
                       {
                          &quot;value&quot;: 3.9967,
                             &quot;ID&quot;: 16
                       }
                     ]
}</code></pre><ul><li><code>molecule_mapping_file_path</code>   – the files in <code>H_params_path</code> might not be named in a manner for the user to know which molecule entry corresponds to which JSON file. Therefore, the user should further define a single JSON file that encodes this mapping.   Example: if the file <code>bmse000976_simulation_1.json</code> corresponds to the molecule entry &quot;L-Histidine&quot; and the file <code>Histidine_Govindaraju_2000.json</code> corresponds to the molecule entry &quot;L-Histidine - Govindaraju&quot;, and suppose the user only wants to target these two entries, i.e. <code>target_entries</code> contain only these two entries. Then the following entry-filename-mapping JSON file should be used, and <code>molecule_mapping_file_path</code> should be the path to this entry-filename-mapping file.</li></ul><pre><code class="nohighlight hljs">{
    &quot;L-Histidine&quot;: {
        &quot;notes&quot;: &quot;http://gissmo.bmrb.io/entry/bmse000976/simulation_1&quot;,
       &quot;file name&quot;: &quot;bmse000976_simulation_1.json&quot;
    },
    &quot;L-Histidine - Govindaraju&quot;: {
        &quot;notes&quot;: &quot;https://pubmed.ncbi.nlm.nih.gov/10861994/&quot;,
       &quot;file name&quot;: &quot;Histidine_Govindaraju_2000.json&quot;
    }
}</code></pre><p><strong>Optional inputs</strong></p><ul><li><code>unique_cs_digits</code>   – Two chemical shift values in the same JSON file are assigned the same chemical shift value to both nuclei if the two values in the file differ less than <code>unique_cs_digits</code> many decimal places.</li></ul><p><strong>Outputs</strong></p><ul><li><p><code>Phys::Vector{PhysicalParamsType{Float64}</code>    – list of the data type <code>PhysicalParamsType</code> that contain chemical shift and J-coupling information for each of the molecule entries in <code>target_entries</code>.</p></li><li><p><code>dict_molecule_to_filename</code>                   – the dictionary that maps molecule entries to meta information such as their corresponding JSON filenames</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/IO/IO_phys.jl#L349-L445">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.extractcs" href="#NMRHamiltonian.extractcs"><code>NMRHamiltonian.extractcs</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">extractcs(Phys::Vector{PhysicalParamsType{T}}) where T</code></pre><p>Assemble the J-coupling and chemical shift values from JSON files for the specified molecules.</p><p>Construction functions for molecule mixture-related configurations in NMRHamiltonian.jl depend on a provided list of the number of spin systems and singlets for each molecule. The constructor functions can be inferred this information from the output quantities of this function.</p><p><strong>Inputs</strong></p><ul><li><code>Phys</code><code>::Vector{PhysicalParamsType{T}}</code></li></ul><p>Physical parameters for multiple molecule entries.</p><p><strong>Outputs</strong></p><ul><li><code>cs_sys_mixture:</code><code>::Vector{Vector{Vector{T}}}</code></li></ul><p>The set of chemical shift values for non-singlet spin systems for multiple molecule entries. See <code>PhysicalParamsType</code>.</p><ul><li><code>cs_singlets_mixture</code><code>::Vector{Vector{T}}</code></li></ul><p>Singlet chemical shift values for multiple molecule entries. See <code>PhysicalParamsType</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/IO/IO_phys.jl#L317-L336">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.simulate" href="#NMRHamiltonian.simulate"><code>NMRHamiltonian.simulate</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">simulate(
    Phys::Vector{PhysicalParamsType{T}},
    molecule_entries::Vector{String},
    fs::T,
    SW::T,
    ν_0ppm::T,
    config::SHConfig;
) where T &lt;: AbstractFloat</code></pre><p>Simulate the resonance components&#39; intensities and frequencies, compute order of coherences for each component, and group the components into resonance groups.</p><p><strong>Inputs</strong></p><ul><li><code>Phys</code> – A <code>Vector</code> of physical chemistry parameters, e.g. the output of getphysicalparameters().</li><li><code>molecule_entries</code> – A <code>Vector</code> of compound entries.</li><li><code>fs</code> – the sampling frequency in Hz for use in the simulation.</li><li><code>SW</code> – the spectral window in ppm for use in the simulation.</li><li><code>ν_0ppm</code> – the 0 ppm peak frequency in Hz in the spectrum, for use in the simulation.</li><li><code>config</code> – a configuration file of type <code>SHConfig</code>.</li></ul><p><strong>Outputs</strong></p><ul><li><p><code>As::Vector{SHType{Float64}}</code> – the simulated resonance intensities and frequencies, sub-system order of coherences, and resonance groups.</p></li><li><p><code>MSPs</code> – the spin Hamiltonian matrices and coherence-related quantities. For diagnostic purposes.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/engine/front_end.jl#L1-L30">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.readbasechemshifts" href="#NMRHamiltonian.readbasechemshifts"><code>NMRHamiltonian.readbasechemshifts</code></a> — <span class="docstring-category">Function</span></header><section><div><p>function readbasechemshifts(P::PhysicalParamsType{T})::Vector{Vector{T}} where T</p><p>Outputs <code>shifts</code>, with index structure [spin system][cs index]. cs is in ppm. Singlet spin systems are at the end of <code>shifts</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/IO/IO_phys.jl#L88-L92">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.writebasechemshifts!" href="#NMRHamiltonian.writebasechemshifts!"><code>NMRHamiltonian.writebasechemshifts!</code></a> — <span class="docstring-category">Function</span></header><section><div><p>function writebasechemshifts!(P::PhysicalParamsType{T}, shifts::Vector{Vector{T}}) where T</p><p><code>shifts</code>: index structure [spin system][cs index]. cs has to be in ppm. Singlet spin systems are at the end of <code>shifts</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/IO/IO_phys.jl#L97-L101">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.extractMEnuclei" href="#NMRHamiltonian.extractMEnuclei"><code>NMRHamiltonian.extractMEnuclei</code></a> — <span class="docstring-category">Function</span></header><section><div><p>extractMEnuclei(     Phys::Vector{PhysicalParamsType{T}}, ) where T</p><p>Outputs: IDs, cs, entry_IDs</p><ul><li>IDs::Vector{Vector{Int}}</li></ul><p>Each entry contains the set of nuclei labels that is associated with the corresponding entry in <code>cs</code>.</p><ul><li>cs::Vector{T}</li></ul><p>Each entry contains the chemical shift entry of a magnetically equivalent group of nuclei. The magnetic equivalent is based on the data stored in the <code>ME</code> field of the entries in Phy`.</p><ul><li>entry_IDs::Vector{Tuple{Int,Int}}</li></ul><p>Each entry contains a pair of integers that is associated with the corresponding entry in <code>cs</code>. The first integer is the molecule entry number. The second is the spin system number that the corresponding nuclei in <code>IDs</code> belongs to.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/IO/IO_phys.jl#L230-L244">source</a></section></article><h2 id="Simulation"><a class="docs-heading-anchor" href="#Simulation">Simulation</a><a id="Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.SHConfig" href="#NMRHamiltonian.SHConfig"><code>NMRHamiltonian.SHConfig</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">@kwdef struct SHConfig{T &lt;: Real}
    coherence_tol::T = convert(T, 0.01)
    relative_α_threshold::T = convert(T, 0.005) # initial intensity pruning.
    tol_radius_1D::T = convert(T, 0.1) # strictly between 0 and 1. The lower, the better the approximation, but would a larger partition (i.e. more resonance groups).
    max_deviation_from_mean::T = convert(T, 0.2)
    acceptance_factor::T = convert(T, 0.99)
    total_α_threshold::T = convert(T, 0.01) # final intensity pruning.
end</code></pre><p>Configuration settings for the spin Hamiltonian simulation portion of <code>simulate()</code>.</p><p>The parameters here control the trade-off between the number of coherence difference features, the set of Δc&#39;s, and the number of resonance groups, the set of Δc_bar&#39;s, that are generated. The more resonance groups, the better the approximation to the ideal model where each Δc is a resonance group. The resultant model becomes more computationally intensive as the number of resonance groups increase.</p><p>≡≡≡≡≡≡≡≡ Details ≡≡≡≡≡≡≡≡</p><p><strong><code>coherence_tol::T</code></strong></p><p>This controls the number of Δc features we get, by how far their sum deviate from <code>-1</code>.</p><p><strong><code>relative_α_threshold::T</code></strong></p><p>This controls the number of Δc feature we get, by how intense their corresponding resonance intensity is relative to the maximum intensity within their local spin system.</p><p><strong><code>max_deviation_from_mean::T</code></strong></p><p>This non-negative controls the number of resonance groups we get. The smaller, the more resonance groups, but better approximation to the preliminary model.</p><p><strong><code>acceptance_factor::T</code></strong></p><p>This non-negative controls the number of resonance groups we get. Takes on value strictly between 0 to 1. Tends to create less resonance groups when it is close to 1, but takes longer to compute.</p><p><strong><code>total_α_threshold::T</code></strong></p><p>This non-negative controls the number of resonance groups we get. This dictates the cumulative intensity threshold for resonance groups, as a proportionality factor of the total intensity of the spin system. The least intense groups that cumulatively add to less than this value is discarded, and αs and Ωs and Δc are updated according to the kept components. Takes on value from [0, 1). When set to zero, does not prune any resonance groups of low intensity during the post-processing step.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/types.jl#L4-L40">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.SHType" href="#NMRHamiltonian.SHType"><code>NMRHamiltonian.SHType</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">struct SHType{T}

    # resonance components for each spin systems (indexed by first/outer index).
    αs::Vector{Vector{T}}
    Ωs::Vector{Vector{T}}

    Δc::Vector{Vector{Vector{T}}}
    parts::Vector{Vector{Vector{Int}}}
    Δc_bar::Vector{Vector{Vector{T}}}

    # the number of spins for each spin system.
    N_spins_sys::Vector{Int}

    # misc input for the SH simulation.
    fs::T
    SW::T
    ν_0ppm::T
end</code></pre><p>Container for the spin Hamiltonian simulation result of a molecule entry. All arrays follow the 1-indexing scheme.</p><p>Frequency information about the NMR data and spectrometer can be obtained from these information. Spectrometer frequency (in MHz) is calculated as SW/fs, where <code>SW</code> is in ppm, and <code>fs</code> is in Hz. An example value is 700.14 ≈ 14005.6/20.004.</p><p>To convert from Hz to ppm frequency units, and the inverse, use the following anonymous functions:</p><pre><code class="nohighlight hljs">hz2ppmfunc = uu-&gt;(uu - ν_0ppm)*SW/fs
ppm2hzfunc = pp-&gt;(ν_0ppm + pp*fs/SW)</code></pre><p>Fields ≡≡≡≡≡≡≡≡</p><ul><li><code>αs</code><code>::Vector{Vector{T}}</code></li></ul><p>Resonance intensities for each spin systems. Index <code>[i][l]</code> refers to the i-th spin system, l-th resonnace component.</p><ul><li><code>Ωs</code><code>::Vector{Vector{T}}</code></li></ul><p>Resonance frequencies for each  spin systems. In units radians. To convert to Hz, divide by <code>2π</code>.  Index <code>[i][l]</code> refers to the i-th spin system, l-th resonnace component.</p><ul><li><code>Δc</code><code>::Vector{Vector{Vector{T}}}</code></li></ul><p>Index <code>[i][l]</code> is a 1-D array of the Δc feature of the l-th resonance component in the i-th spin system. The Δc feature of a resonance component can be interpreted as the partial contributions to the quantum number of the resonance component from each subsystem of the the composite spin system. Its eleemnts take on values betwee <code>-1</code> and <code>1</code> for spin-1/2 NMR.</p><ul><li><code>parts</code><code>::Vector{Vector{Vector{Int}}}</code></li></ul><p>For a fixed spin system <code>i</code>, <code>parts[i][k]</code> is a 1-D array of indices that specify which of the resonance components (e.g., which elements of αs[i] and Ωs[i]) belong in the resonance group (i,k). The following creates <code>α_ik</code>, the resonance components for the (i,k)-th resonance group of the molecule entry:</p><pre><code class="nohighlight hljs">α_ik = αs[parts[i][k]]</code></pre><p>The indices in <code>parts</code> follow the 1-indexing scheme.</p><ul><li><code>Δc_bar</code><code>::Vector{Vector{Vector{T}}}</code></li></ul><p>Index <code>[i][k]</code> is the weighted average of the features of the (i,k)-th resonance group. The features are </p><pre><code class="nohighlight hljs">Δc_ik = Δc[parts[i][k]]</code></pre><p>and the weights are </p><pre><code class="nohighlight hljs">αs[parts[i][k]]</code></pre><p>The length of each <code>Δc_bar[i]</code> in a spin system should be the same, and should be less than or equal to the number of spins in the i-th spin system. It won&#39;t be equal if there are exhibits magnetic equivalence between the spins.</p><ul><li><code>N_spins_sys</code><code>::VectorInt}</code></li></ul><p>The i-th element is the number of spins in the i-th spin system.</p><ul><li><code>αs_singlets</code><code>::Vector{T}</code></li></ul><p>The i-th element is the resonance intensity for the i-th singlet resonance component.</p><ul><li><code>Ωs_singlets</code><code>::Vector{T}</code></li></ul><p>The i-th element is the resonance frequency for the i-th singlet resonance component. To convert to Hz, divide by <code>2π</code>.</p><ul><li><p><code>fs</code>Sampling frequency of the spectrometer, in Hz. This is the rate at which the complex-valued free-induction decay signal is sampled at. An example value is around 14005.6 Hz for a 700 MHz spectrometer.</p></li><li><p><code>SW</code>Spectral window in ppm for the spectrometer. An example value is around 20.004 ppm for a 700 MHz spectrometer.</p></li><li><p><code>ν_0ppm</code>The 0 ppm reference frequency, in Hz. An example value is around 10656.01 Hz for a spectrometer with <code>SW</code> ≈ 20.004 ppm and <code>fs</code> ≈ 14005.6 Hz.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/types.jl#L60-L101">source</a></section></article><h2 id="Serialization,-input/output"><a class="docs-heading-anchor" href="#Serialization,-input/output">Serialization, input/output</a><a id="Serialization,-input/output-1"></a><a class="docs-heading-anchor-permalink" href="#Serialization,-input/output" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.serializemixture" href="#NMRHamiltonian.serializemixture"><code>NMRHamiltonian.serializemixture</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function serializemixture(
    As::Vector{SHType{T}},
) where T</code></pre><p>Returns a <code>Dict{Symbol, Any}</code> object, which can then be used with file serialization packages for saving to disk. For use with <code>saveasJSOn()</code>; see its docstring for more details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/serialize.jl#L18-L26">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.deserializemixture" href="#NMRHamiltonian.deserializemixture"><code>NMRHamiltonian.deserializemixture</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">deserializemixture(W)</code></pre><p>W is of a data type that can be addressed via a key (of type <code>Symbol</code>) and returns a value. Example data types that W can be are <code>Dict{Symbol, Any}</code> or a <code>JSON3</code> Object.</p><p>Outputs a <code>Vector{SHType{T}}</code> variable, where <code>T</code> is the data type of the key <code>:fs</code> in <code>W</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/serialize.jl#L92-L99">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.serializephysicalparams" href="#NMRHamiltonian.serializephysicalparams"><code>NMRHamiltonian.serializephysicalparams</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">serializephysicalparams(
    Phys::Vector{PhysicalParamsType{T}},
    molecule_entries::Vector{String},
    ) where T</code></pre><p>Returns a <code>Dict{Symbol, Any}</code> object, which can then be used with file serialization packages for saving to disk.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/serialize.jl#L147-L155">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.deserializephysicalparams" href="#NMRHamiltonian.deserializephysicalparams"><code>NMRHamiltonian.deserializephysicalparams</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">deserializephysicalparams(W)</code></pre><p>W is of a data type that can be addressed via a key (of type <code>Symbol</code>) and returns a value. Example data types that W can be are <code>Dict{Symbol, Any}</code> or a <code>JSON3</code> Object.</p><p>Outputs a <code>Vector{PhysicalParamsType{T}}</code> and a <code>Vector{String}</code> variable. <code>T</code> is the value stored in the <code>:T</code> key in <code>W</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/serialize.jl#L235-L242">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.saveasJSON" href="#NMRHamiltonian.saveasJSON"><code>NMRHamiltonian.saveasJSON</code></a> — <span class="docstring-category">Function</span></header><section><div><p>saveasJSON(     output<em>folder::String,     file</em>name::String,     dict, )</p><p>Example setup:</p><pre><code class="nohighlight hljs">config = HAM.SHConfig{T}(
    coherence_tol = convert(T, 0.01),
    relative_α_threshold = convert(T, 0.005),
    max_deviation_from_mean = convert(T, 0.2),
    acceptance_factor = convert(T, 0.99),
    total_α_threshold = convert(T, 0.01), # final intensity pruning.
)
unique_cs_digits = 6

Phys, As, MSPs = HAM.loadandsimulate(
    T,
    spectrometer_tag,
    molecule_entries,
    H_params_path,
    molecule_mapping_file_path;
    config = config,
    unique_cs_digits = unique_cs_digits,
    
)</code></pre><p>Usage with physical parameters:</p><pre><code class="nohighlight hljs">S_Phys = HAM.serializephysicalparams(Phys, molecule_entries)
HAM.saveasJSON(
    joinpath(save_folder_path, &quot;Phys.json&quot;),
    S_Phys,
)</code></pre><p>Usage with simulation results:</p><pre><code class="nohighlight hljs">S_As = HAM.serializemixture(As)
HAM.saveasJSON(
    joinpath(save_folder_path, &quot;As.json&quot;),
    S_As,
)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/IO/config_IO.jl#L4-L50">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NMRHamiltonian.readJSON" href="#NMRHamiltonian.readJSON"><code>NMRHamiltonian.readJSON</code></a> — <span class="docstring-category">Function</span></header><section><div><p>readJSON(file_path::String)</p><p>Usage:</p><pre><code class="nohighlight hljs"># save.
S_Phys = HAM.serializephysicalparams(Phys, molecule_entries)
HAM.saveasJSON(
    Phys_filename,
    S_Phys,
)

# load.
dict_Phys = HAM.readJSON(Phys_filename)
Phys_rec, molecule_entries_rec = HAM.deserializephysicalparams(Dict(dict_Phys))
</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/AI4DBiological-Systems/NMRHamiltonian.jl/blob/5e76e47a68035580ddece54eddb5abe7053de5fb/src/IO/config_IO.jl#L77-L94">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Overview</a><a class="docs-footer-nextpage" href="../demo_code/">Demo: code walk-through »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Friday 19 July 2024 06:07">Friday 19 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
